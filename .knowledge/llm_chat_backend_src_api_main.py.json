{"is_source_file": true, "format": "Python", "description": "This is a Python source file implementing an API backend using FastAPI, providing endpoints for health checks, server info, and chat completions that interface with OpenAI-like APIs.", "external_files": ["fastapi", "pydantic", "starlette.responses", "starlette.requests", "httpx"], "external_methods": ["fastapi.Depends", "fastapi.FastAPI", "fastapi.Header", "fastapi.HTTPException", "fastapi.Request", "fastapi.Response", "starlette.responses.JSONResponse", "starlette.requests.ClientDisconnect"], "published": ["create_app", "app"], "classes": [{"name": "ChatMessage", "description": "Pydantic model for chat message with role and content."}, {"name": "ChatRequest", "description": "Pydantic model for chat request containing messages and optional parameters."}, {"name": "ChoiceMessage", "description": "Pydantic model for assistant message in choices."}, {"name": "Choice", "description": "Pydantic model representing a choice in the chat response."}, {"name": "Usage", "description": "Pydantic model for token usage statistics."}, {"name": "ChatResponse", "description": "Pydantic model for chat completion response."}, {"name": "ServerInfo", "description": "Pydantic model for server metadata info."}], "methods": [{"name": "Optional[str] get_env(var_name: str, default: Optional[str] = None)", "description": "Retrieve environment variables with optional default.", "scope": "", "scopeKind": ""}, {"name": "str require_openai_key( authorization: Optional[str] = Header(default=None, alias=\"Authorization\"), )", "description": "Dependency to validate or retrieve OpenAI API key.", "scope": "", "scopeKind": ""}, {"name": "FastAPI create_app()", "description": "Factory function to create and configure the FastAPI app with routes.", "scope": "", "scopeKind": ""}, {"name": "ChatResponse chat_completions( payload: ChatRequest, request: Request, api_key: str = Depends(require_openai_key), )", "scope": "create_app", "scopeKind": "function", "description": "unavailable"}, {"name": "Response client_disconnect_handler(request: Request, exc: ClientDisconnect)", "scope": "create_app", "scopeKind": "function", "description": "unavailable"}, {"name": "Dict[str,str] health_check()", "scope": "create_app", "scopeKind": "function", "description": "unavailable"}, {"name": "ServerInfo info()", "scope": "create_app", "scopeKind": "function", "description": "unavailable"}, {"name": "JSONResponse validation_exception_handler(request: Request, exc: ValidationError)", "scope": "create_app", "scopeKind": "function", "description": "unavailable"}, {"name": "Dict[str,Any] websocket_docs()", "scope": "create_app", "scopeKind": "function", "description": "unavailable"}], "calls": ["get_env", "get_env", "get_env", "require_openai_key", "create_app", "app.get", "app.get", "app.post", "client.post", "time.time", "json.loads", "json.dumps"], "search-terms": ["FastAPI", "OpenAI API", "ChatCompletion", "Health Check", "Server Info", "API endpoints", "chat messages", "streaming", "CORS middleware", "environment variables"], "state": 2, "file_id": 3, "knowledge_revision": 10, "git_revision": "94a37d4da92294111064568ccd9400e88b45add9", "revision_history": [{"9": "94a37d4da92294111064568ccd9400e88b45add9"}, {"10": "94a37d4da92294111064568ccd9400e88b45add9"}], "ctags": [{"_type": "tag", "name": "APP_DESC", "path": "/home/kavia/workspace/code-generation/openai-chat-assistant-21646-21655/llm_chat_backend/src/api/main.py", "pattern": "/^APP_DESC = ($/", "language": "Python", "kind": "variable"}, {"_type": "tag", "name": "APP_NAME", "path": "/home/kavia/workspace/code-generation/openai-chat-assistant-21646-21655/llm_chat_backend/src/api/main.py", "pattern": "/^APP_NAME = \"LLM Chat Backend\"$/", "language": "Python", "kind": "variable"}, {"_type": "tag", "name": "APP_VERSION", "path": "/home/kavia/workspace/code-generation/openai-chat-assistant-21646-21655/llm_chat_backend/src/api/main.py", "pattern": "/^APP_VERSION = \"1.0.0\"$/", "language": "Python", "kind": "variable"}, {"_type": "tag", "name": "ChatMessage", "path": "/home/kavia/workspace/code-generation/openai-chat-assistant-21646-21655/llm_chat_backend/src/api/main.py", "pattern": "/^class ChatMessage(BaseModel):$/", "language": "Python", "kind": "class"}, {"_type": "tag", "name": "ChatRequest", "path": "/home/kavia/workspace/code-generation/openai-chat-assistant-21646-21655/llm_chat_backend/src/api/main.py", "pattern": "/^class ChatRequest(BaseModel):$/", "language": "Python", "kind": "class"}, {"_type": "tag", "name": "ChatResponse", "path": "/home/kavia/workspace/code-generation/openai-chat-assistant-21646-21655/llm_chat_backend/src/api/main.py", "pattern": "/^class ChatResponse(BaseModel):$/", "language": "Python", "kind": "class"}, {"_type": "tag", "name": "Choice", "path": "/home/kavia/workspace/code-generation/openai-chat-assistant-21646-21655/llm_chat_backend/src/api/main.py", "pattern": "/^class Choice(BaseModel):$/", "language": "Python", "kind": "class"}, {"_type": "tag", "name": "ChoiceMessage", "path": "/home/kavia/workspace/code-generation/openai-chat-assistant-21646-21655/llm_chat_backend/src/api/main.py", "pattern": "/^class ChoiceMessage(BaseModel):$/", "language": "Python", "kind": "class"}, {"_type": "tag", "name": "ServerInfo", "path": "/home/kavia/workspace/code-generation/openai-chat-assistant-21646-21655/llm_chat_backend/src/api/main.py", "pattern": "/^class ServerInfo(BaseModel):$/", "language": "Python", "kind": "class"}, {"_type": "tag", "name": "Usage", "path": "/home/kavia/workspace/code-generation/openai-chat-assistant-21646-21655/llm_chat_backend/src/api/main.py", "pattern": "/^class Usage(BaseModel):$/", "language": "Python", "kind": "class"}, {"_type": "tag", "name": "api_base", "path": "/home/kavia/workspace/code-generation/openai-chat-assistant-21646-21655/llm_chat_backend/src/api/main.py", "pattern": "/^    api_base: Optional[str] = Field(None, description=\"OpenAI API base URL in use.\")$/", "language": "Python", "typeref": "typename:Optional[str]", "kind": "variable", "scope": "ServerInfo", "scopeKind": "class"}, {"_type": "tag", "name": "app", "path": "/home/kavia/workspace/code-generation/openai-chat-assistant-21646-21655/llm_chat_backend/src/api/main.py", "pattern": "/^app = create_app()$/", "language": "Python", "kind": "variable"}, {"_type": "tag", "name": "chat_completions", "path": "/home/kavia/workspace/code-generation/openai-chat-assistant-21646-21655/llm_chat_backend/src/api/main.py", "pattern": "/^    async def chat_completions($/", "file": true, "language": "Python", "typeref": "typename:ChatResponse", "kind": "function", "signature": "( payload: ChatRequest, request: Request, api_key: str = Depends(require_openai_key), )", "scope": "create_app", "scopeKind": "function"}, {"_type": "tag", "name": "choices", "path": "/home/kavia/workspace/code-generation/openai-chat-assistant-21646-21655/llm_chat_backend/src/api/main.py", "pattern": "/^    choices: List[Choice] = Field(..., description=\"List of response choices.\")$/", "language": "Python", "typeref": "typename:List[Choice]", "kind": "variable", "scope": "ChatResponse", "scopeKind": "class"}, {"_type": "tag", "name": "client_disconnect_handler", "path": "/home/kavia/workspace/code-generation/openai-chat-assistant-21646-21655/llm_chat_backend/src/api/main.py", "pattern": "/^    async def client_disconnect_handler(request: Request, exc: ClientDisconnect) -> Response:$/", "file": true, "language": "Python", "typeref": "typename:Response", "kind": "function", "signature": "(request: Request, exc: ClientDisconnect)", "scope": "create_app", "scopeKind": "function"}, {"_type": "tag", "name": "completion_tokens", "path": "/home/kavia/workspace/code-generation/openai-chat-assistant-21646-21655/llm_chat_backend/src/api/main.py", "pattern": "/^    completion_tokens: Optional[int] = Field(None, description=\"Count of tokens in the completio/", "language": "Python", "typeref": "typename:Optional[int]", "kind": "variable", "scope": "Usage", "scopeKind": "class"}, {"_type": "tag", "name": "content", "path": "/home/kavia/workspace/code-generation/openai-chat-assistant-21646-21655/llm_chat_backend/src/api/main.py", "pattern": "/^    content: str = Field($/", "language": "Python", "typeref": "typename:str", "kind": "variable", "scope": "ChatMessage", "scopeKind": "class"}, {"_type": "tag", "name": "content", "path": "/home/kavia/workspace/code-generation/openai-chat-assistant-21646-21655/llm_chat_backend/src/api/main.py", "pattern": "/^    content: str = Field(..., description=\"Assistant message content.\")$/", "language": "Python", "typeref": "typename:str", "kind": "variable", "scope": "ChoiceMessage", "scopeKind": "class"}, {"_type": "tag", "name": "create_app", "path": "/home/kavia/workspace/code-generation/openai-chat-assistant-21646-21655/llm_chat_backend/src/api/main.py", "pattern": "/^def create_app() -> FastAPI:$/", "language": "Python", "typeref": "typename:FastAPI", "kind": "function", "signature": "()"}, {"_type": "tag", "name": "created", "path": "/home/kavia/workspace/code-generation/openai-chat-assistant-21646-21655/llm_chat_backend/src/api/main.py", "pattern": "/^    created: int = Field(..., description=\"Unix timestamp of creation.\")$/", "language": "Python", "typeref": "typename:int", "kind": "variable", "scope": "ChatResponse", "scopeKind": "class"}, {"_type": "tag", "name": "default_model", "path": "/home/kavia/workspace/code-generation/openai-chat-assistant-21646-21655/llm_chat_backend/src/api/main.py", "pattern": "/^    default_model: Optional[str] = Field(None, description=\"Default model if configured.\")$/", "language": "Python", "typeref": "typename:Optional[str]", "kind": "variable", "scope": "ServerInfo", "scopeKind": "class"}, {"_type": "tag", "name": "finish_reason", "path": "/home/kavia/workspace/code-generation/openai-chat-assistant-21646-21655/llm_chat_backend/src/api/main.py", "pattern": "/^    finish_reason: Optional[str] = Field($/", "language": "Python", "typeref": "typename:Optional[str]", "kind": "variable", "scope": "Choice", "scopeKind": "class"}, {"_type": "tag", "name": "get_env", "path": "/home/kavia/workspace/code-generation/openai-chat-assistant-21646-21655/llm_chat_backend/src/api/main.py", "pattern": "/^def get_env(var_name: str, default: Optional[str] = None) -> Optional[str]:$/", "language": "Python", "typeref": "typename:Optional[str]", "kind": "function", "signature": "(var_name: str, default: Optional[str] = None)"}, {"_type": "tag", "name": "health_check", "path": "/home/kavia/workspace/code-generation/openai-chat-assistant-21646-21655/llm_chat_backend/src/api/main.py", "pattern": "/^    async def health_check() -> Dict[str, str]:$/", "file": true, "language": "Python", "typeref": "typename:Dict[str,str]", "kind": "function", "signature": "()", "scope": "create_app", "scopeKind": "function"}, {"_type": "tag", "name": "id", "path": "/home/kavia/workspace/code-generation/openai-chat-assistant-21646-21655/llm_chat_backend/src/api/main.py", "pattern": "/^    id: Optional[str] = Field(None, description=\"Identifier for the response.\")$/", "language": "Python", "typeref": "typename:Optional[str]", "kind": "variable", "scope": "ChatResponse", "scopeKind": "class"}, {"_type": "tag", "name": "index", "path": "/home/kavia/workspace/code-generation/openai-chat-assistant-21646-21655/llm_chat_backend/src/api/main.py", "pattern": "/^    index: int = Field(..., description=\"Index of the choice in the result set.\")$/", "language": "Python", "typeref": "typename:int", "kind": "variable", "scope": "Choice", "scopeKind": "class"}, {"_type": "tag", "name": "info", "path": "/home/kavia/workspace/code-generation/openai-chat-assistant-21646-21655/llm_chat_backend/src/api/main.py", "pattern": "/^    async def info() -> ServerInfo:$/", "file": true, "language": "Python", "typeref": "typename:ServerInfo", "kind": "function", "signature": "()", "scope": "create_app", "scopeKind": "function"}, {"_type": "tag", "name": "max_tokens", "path": "/home/kavia/workspace/code-generation/openai-chat-assistant-21646-21655/llm_chat_backend/src/api/main.py", "pattern": "/^    max_tokens: Optional[int] = Field($/", "language": "Python", "typeref": "typename:Optional[int]", "kind": "variable", "scope": "ChatRequest", "scopeKind": "class"}, {"_type": "tag", "name": "message", "path": "/home/kavia/workspace/code-generation/openai-chat-assistant-21646-21655/llm_chat_backend/src/api/main.py", "pattern": "/^    message: ChoiceMessage = Field(..., description=\"The assistant message for this choice.\")$/", "language": "Python", "typeref": "typename:ChoiceMessage", "kind": "variable", "scope": "Choice", "scopeKind": "class"}, {"_type": "tag", "name": "messages", "path": "/home/kavia/workspace/code-generation/openai-chat-assistant-21646-21655/llm_chat_backend/src/api/main.py", "pattern": "/^    messages: List[ChatMessage] = Field($/", "language": "Python", "typeref": "typename:List[ChatMessage]", "kind": "variable", "scope": "ChatRequest", "scopeKind": "class"}, {"_type": "tag", "name": "model", "path": "/home/kavia/workspace/code-generation/openai-chat-assistant-21646-21655/llm_chat_backend/src/api/main.py", "pattern": "/^    model: Optional[str] = Field($/", "language": "Python", "typeref": "typename:Optional[str]", "kind": "variable", "scope": "ChatRequest", "scopeKind": "class"}, {"_type": "tag", "name": "model", "path": "/home/kavia/workspace/code-generation/openai-chat-assistant-21646-21655/llm_chat_backend/src/api/main.py", "pattern": "/^    model: str = Field(..., description=\"Model used for the completion.\")$/", "language": "Python", "typeref": "typename:str", "kind": "variable", "scope": "ChatResponse", "scopeKind": "class"}, {"_type": "tag", "name": "name", "path": "/home/kavia/workspace/code-generation/openai-chat-assistant-21646-21655/llm_chat_backend/src/api/main.py", "pattern": "/^    name: str = Field(..., description=\"Application name.\")$/", "language": "Python", "typeref": "typename:str", "kind": "variable", "scope": "ServerInfo", "scopeKind": "class"}, {"_type": "tag", "name": "object", "path": "/home/kavia/workspace/code-generation/openai-chat-assistant-21646-21655/llm_chat_backend/src/api/main.py", "pattern": "/^    object: str = Field(\"chat.completion\", description=\"Object type.\")$/", "language": "Python", "typeref": "typename:str", "kind": "variable", "scope": "ChatResponse", "scopeKind": "class"}, {"_type": "tag", "name": "openai_configured", "path": "/home/kavia/workspace/code-generation/openai-chat-assistant-21646-21655/llm_chat_backend/src/api/main.py", "pattern": "/^    openai_configured: bool = Field(..., description=\"Whether an OpenAI API key is configured.\")$/", "language": "Python", "typeref": "typename:bool", "kind": "variable", "scope": "ServerInfo", "scopeKind": "class"}, {"_type": "tag", "name": "prompt_tokens", "path": "/home/kavia/workspace/code-generation/openai-chat-assistant-21646-21655/llm_chat_backend/src/api/main.py", "pattern": "/^    prompt_tokens: Optional[int] = Field(None, description=\"Count of tokens in the prompt.\")$/", "language": "Python", "typeref": "typename:Optional[int]", "kind": "variable", "scope": "Usage", "scopeKind": "class"}, {"_type": "tag", "name": "require_openai_key", "path": "/home/kavia/workspace/code-generation/openai-chat-assistant-21646-21655/llm_chat_backend/src/api/main.py", "pattern": "/^def require_openai_key($/", "language": "Python", "typeref": "typename:str", "kind": "function", "signature": "( authorization: Optional[str] = Header(default=None, alias=\"Authorization\"), )"}, {"_type": "tag", "name": "role", "path": "/home/kavia/workspace/code-generation/openai-chat-assistant-21646-21655/llm_chat_backend/src/api/main.py", "pattern": "/^    role: Literal[\"assistant\"] = Field(..., description=\"Role of the assistant response.\")$/", "language": "Python", "typeref": "typename:Literal[\"assistant\"]", "kind": "variable", "scope": "ChoiceMessage", "scopeKind": "class"}, {"_type": "tag", "name": "role", "path": "/home/kavia/workspace/code-generation/openai-chat-assistant-21646-21655/llm_chat_backend/src/api/main.py", "pattern": "/^    role: Literal[\"system\", \"user\", \"assistant\"] = Field($/", "language": "Python", "typeref": "typename:Literal[\"system\", \"user\", \"assistant\"]", "kind": "variable", "scope": "ChatMessage", "scopeKind": "class"}, {"_type": "tag", "name": "stream", "path": "/home/kavia/workspace/code-generation/openai-chat-assistant-21646-21655/llm_chat_backend/src/api/main.py", "pattern": "/^    stream: Optional[bool] = Field($/", "language": "Python", "typeref": "typename:Optional[bool]", "kind": "variable", "scope": "ChatRequest", "scopeKind": "class"}, {"_type": "tag", "name": "temperature", "path": "/home/kavia/workspace/code-generation/openai-chat-assistant-21646-21655/llm_chat_backend/src/api/main.py", "pattern": "/^    temperature: Optional[float] = Field($/", "language": "Python", "typeref": "typename:Optional[float]", "kind": "variable", "scope": "ChatRequest", "scopeKind": "class"}, {"_type": "tag", "name": "theme", "path": "/home/kavia/workspace/code-generation/openai-chat-assistant-21646-21655/llm_chat_backend/src/api/main.py", "pattern": "/^    theme: Dict[str, str] = Field(..., description=\"Theme color tokens for UI clients.\")$/", "language": "Python", "typeref": "typename:Dict[str, str]", "kind": "variable", "scope": "ServerInfo", "scopeKind": "class"}, {"_type": "tag", "name": "top_p", "path": "/home/kavia/workspace/code-generation/openai-chat-assistant-21646-21655/llm_chat_backend/src/api/main.py", "pattern": "/^    top_p: Optional[float] = Field($/", "language": "Python", "typeref": "typename:Optional[float]", "kind": "variable", "scope": "ChatRequest", "scopeKind": "class"}, {"_type": "tag", "name": "total_tokens", "path": "/home/kavia/workspace/code-generation/openai-chat-assistant-21646-21655/llm_chat_backend/src/api/main.py", "pattern": "/^    total_tokens: Optional[int] = Field(None, description=\"Total tokens used.\")$/", "language": "Python", "typeref": "typename:Optional[int]", "kind": "variable", "scope": "Usage", "scopeKind": "class"}, {"_type": "tag", "name": "usage", "path": "/home/kavia/workspace/code-generation/openai-chat-assistant-21646-21655/llm_chat_backend/src/api/main.py", "pattern": "/^    usage: Optional[Usage] = Field(None, description=\"Token usage information.\")$/", "language": "Python", "typeref": "typename:Optional[Usage]", "kind": "variable", "scope": "ChatResponse", "scopeKind": "class"}, {"_type": "tag", "name": "validation_exception_handler", "path": "/home/kavia/workspace/code-generation/openai-chat-assistant-21646-21655/llm_chat_backend/src/api/main.py", "pattern": "/^    async def validation_exception_handler(request: Request, exc: ValidationError) -> JSONRespon/", "file": true, "language": "Python", "typeref": "typename:JSONResponse", "kind": "function", "signature": "(request: Request, exc: ValidationError)", "scope": "create_app", "scopeKind": "function"}, {"_type": "tag", "name": "version", "path": "/home/kavia/workspace/code-generation/openai-chat-assistant-21646-21655/llm_chat_backend/src/api/main.py", "pattern": "/^    version: str = Field(..., description=\"Application semantic version.\")$/", "language": "Python", "typeref": "typename:str", "kind": "variable", "scope": "ServerInfo", "scopeKind": "class"}, {"_type": "tag", "name": "websocket_docs", "path": "/home/kavia/workspace/code-generation/openai-chat-assistant-21646-21655/llm_chat_backend/src/api/main.py", "pattern": "/^    async def websocket_docs() -> Dict[str, Any]:$/", "file": true, "language": "Python", "typeref": "typename:Dict[str,Any]", "kind": "function", "signature": "()", "scope": "create_app", "scopeKind": "function"}], "hash": "953883075486bdba5501b324620fe969", "format-version": 4, "code-base-name": "llm_chat_backend", "filename": "llm_chat_backend/src/api/main.py", "fields": [{"name": "APP_DESC = (", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "APP_NAME = \"LLM Chat Backend\"", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "APP_VERSION = \"1.0.0\"", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "Optional[str] api_base", "scope": "ServerInfo", "scopeKind": "class", "description": "unavailable"}, {"name": "app = create_app()", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "List[Choice] choices", "scope": "ChatResponse", "scopeKind": "class", "description": "unavailable"}, {"name": "Optional[int] completion_tokens", "scope": "Usage", "scopeKind": "class", "description": "unavailable"}, {"name": "str content", "scope": "ChatMessage", "scopeKind": "class", "description": "unavailable"}, {"name": "int created", "scope": "ChatResponse", "scopeKind": "class", "description": "unavailable"}, {"name": "Optional[str] default_model", "scope": "ServerInfo", "scopeKind": "class", "description": "unavailable"}, {"name": "Optional[str] finish_reason", "scope": "Choice", "scopeKind": "class", "description": "unavailable"}, {"name": "Optional[str] id", "scope": "ChatResponse", "scopeKind": "class", "description": "unavailable"}, {"name": "int index", "scope": "Choice", "scopeKind": "class", "description": "unavailable"}, {"name": "Optional[int] max_tokens", "scope": "ChatRequest", "scopeKind": "class", "description": "unavailable"}, {"name": "ChoiceMessage message", "scope": "Choice", "scopeKind": "class", "description": "unavailable"}, {"name": "List[ChatMessage] messages", "scope": "ChatRequest", "scopeKind": "class", "description": "unavailable"}, {"name": "Optional[str] model", "scope": "ChatRequest", "scopeKind": "class", "description": "unavailable"}, {"name": "str model", "scope": "ChatResponse", "scopeKind": "class", "description": "unavailable"}, {"name": "str name", "scope": "ServerInfo", "scopeKind": "class", "description": "unavailable"}, {"name": "str object", "scope": "ChatResponse", "scopeKind": "class", "description": "unavailable"}, {"name": "bool openai_configured", "scope": "ServerInfo", "scopeKind": "class", "description": "unavailable"}, {"name": "Optional[int] prompt_tokens", "scope": "Usage", "scopeKind": "class", "description": "unavailable"}, {"name": "Literal[\"assistant\"] role", "scope": "ChoiceMessage", "scopeKind": "class", "description": "unavailable"}, {"name": "Literal[\"system\", \"user\", \"assistant\"] role", "scope": "ChatMessage", "scopeKind": "class", "description": "unavailable"}, {"name": "Optional[bool] stream", "scope": "ChatRequest", "scopeKind": "class", "description": "unavailable"}, {"name": "Optional[float] temperature", "scope": "ChatRequest", "scopeKind": "class", "description": "unavailable"}, {"name": "Dict[str, str] theme", "scope": "ServerInfo", "scopeKind": "class", "description": "unavailable"}, {"name": "Optional[float] top_p", "scope": "ChatRequest", "scopeKind": "class", "description": "unavailable"}, {"name": "Optional[int] total_tokens", "scope": "Usage", "scopeKind": "class", "description": "unavailable"}, {"name": "Optional[Usage] usage", "scope": "ChatResponse", "scopeKind": "class", "description": "unavailable"}, {"name": "str version", "scope": "ServerInfo", "scopeKind": "class", "description": "unavailable"}]}